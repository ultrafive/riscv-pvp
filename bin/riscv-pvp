#!/bin/bash

env_common()
{
    [ -d .env ] || virtualenv -p python3 .env
    source .env/bin/activate
    [ -f .env/bin/pytest ] || pip install -U pip
    [ -f .env/bin/pytest ] || pip install -r requirements.txt
}


if [ "$1" == 'gen' ] ;then 
    env_common
    python generator.py "${@:2}"

elif [ "$1" == 'run' ] ;then
    env_common
    python runner.py "${@:2}"

elif [ "$1" == 'new' ] ;then
    if [ -n "$2" ];then
        target=$2
    else
        target="custom"
    fi
    cp new_target/target.yml config/${target}.yml
    mkdir isa/${target}
    cp new_target/vmod_vv.py isa/${target}/vmod_vv.py
    echo "from.${target} import *" >> isa/__init__.py
    mkdir specs/${target}
    cp new_target/vmod_vv.spec.yml specs/${target}/vmod_vv.spec.yml
    echo "Create ${target}.yml in ./config."
    echo "Create vmod_vv.py in isa/${target}."
    echo "Create vmod_vv.spec.yml in specs/${target}."
fi

